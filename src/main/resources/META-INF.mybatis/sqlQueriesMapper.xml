<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Configuration 3.0//EN' 
'http://mybatis.org/dtd/mybatis-3-mapper.dtd'>

<mapper namespace="usersQuery">
    <sql id="userWithRole" >
        select u.user_name , u.first_name, u.last_name,u.password,u.birth_date,u.enabled, 
        ur.id,ur.role_name,ur.user_name
        from users u left join user_roles ur on u.user_name = ur.user_name
    </sql>
    <select id="findAll" resultMap="users.map">
        <include refid="userWithRole"/> 
    </select>
    <select id="findByUserName" resultMap="users.map" >
        <include refid="userWithRole"/> where u.user_name = #{userName}
    </select> 
    
    <insert id="save" parameterType="User" >
        insert into users(first_name,last_name,user_name,password
        <if test="#{birthDate}!=null">,birth_date</if>
        ,enabled) values
        (#{firstName},#{lastName},#{userName},#{password}
        <if test="#{birthDate}!=null">,#{birthDate}</if>
        ,#{enabled})       
    </insert>
    
    <update id="update" parameterType="User">
        update users set
        first_name=#{firstName},last_name=#{lastName},
        password=#{password}, enabled=#{enabled},birth_date=#{birthDate}
        where user_name=#{userName}
    </update>
    <delete id="delete" parameterType="User">
        delete from users where user_name=#{userName}
    </delete>
</mapper>



<!--<mapper namespace="rolesQuery">
    <sql id="roleWithUsers" >
        select u.user_name , u.first_name, u.last_name,u.password,u.birth_date,u.enabled, 
        ur.id,ur.role_name,ur.user_name
        from user_roles ur  left join users u on u.user_name = ur.user_name
    </sql>
    <select id="findAll" resultMap="roles.map">
        <include refid="roleWithUsers"/> 
    </select>
    <select id="findById" resultMap="users.map" >
        <include refid="roleWithUsers"/> where r.id = #{id}
    </select> 
    
    <insert id="save" parameterType="Role" >
        insert into user_roles(user_name,role_name) values
        (#{userName},#{roleName})       
    </insert>
    
    <update id="update" parameterType="Role">
        update user_roles set
         user_name=#{userName},role_name=#{roleName}
        where id=#{id}
    </update>
    <delete id="delete" parameterType="User">
        delete from user_roles where id=#{id}
    </delete>
</mapper>-->